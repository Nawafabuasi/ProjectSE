<!DOCTYPE html>
<html>
    <head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta charset="utf-8">
        <link rel="stylesheet" href="styles.css">
        <script src="https://cdn.jsdelivr.net/npm/web3@1.3.0/dist/web3.min.js"></script>
    </head>
    <!-- Header and navigation remain unchanged -->
    <body onload="connectMetamask(); connectcontract();" class="u-body u-xl-mode" data-lang="en">
    <!-- Patient Section -->
    <section class="u-align-center u-clearfix u-grey-5 u-section-1" id="sec-e826">
        <div class="u-clearfix u-sheet u-sheet-1">
            <h1 class="u-text u-text-default u-text-1">Patient Records</h1>
            <div class="u-form u-form-1">
                <form action="#" class="u-clearfix u-form-spacing-0 u-form-vertical u-inner-form" method="POST" style="padding: 17px;">
                    <div class="u-form-group u-form-group-1">
                        <label for="patient-name" class="u-label">Patient Name</label>
                        <input type="text" id="patient-name" name="patient-name" placeholder="Enter patient's name" class="u-input u-input-rectangle">
                    </div>
                    <div class="u-form-group u-form-group-2">
                        <label for="patient-age" class="u-label">Patient Age</label>
                        <input type="number" id="patient-age" name="patient-age" placeholder="Enter patient's age" class="u-input u-input-rectangle">
                    </div>
                    <div class="u-form-group u-form-group-3">
                        <label for="Amount1" class="u-label">Patient Height</label>
                        <input type="text" id="Amount1" name="donation-amount" placeholder="Height" class="u-input u-input-rectangle">
                    </div>
                    <div class="u-align-center u-form-group u-form-submit">
                        
                        <input type="submit" value="submit" class="u-form-control-hidden">
                    </div>
                </div>
                <h1 class="u-text u-text-palette-2-base u-title u-text-2" id="Goal_Eth1"></h1>
        
                <!-- Table for displaying patient records -->
                <table class="patient-records-table" style="width:100%; margin-top: 20px;">
                    <thead>
                        <tr>
                            <th>Patient Name</th>
                            <th>Age</th>
                            <th>Height</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Rows of patient data will be inserted here -->
                    </tbody>
                </table>
            </div>
                    <div class="u-form-send-message u-form-send-success"> Thank you! Your message has been sent. </div>
                    
                </form>
            </div>
            <h1 class="u-text u-text-palette-2-base u-title u-text-2" id="Goal_Eth1"></h1>
            
        </div>
    </section>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.3.0/dist/web3.min.js"></script>

     <script>
        let account;

        const connectMetamask = async () => {
            if (typeof window.ethereum !== "undefined") {
                const accounts = await ethereum.request({ method: "eth_requestAccounts" });
                account = accounts[0];
            } else {
                alert("Please install MetaMask to use this dApp!");
            }
        }
        


        const address = "0xd3963efbe76a9a9874484eadcd64a4f2320fab3e";
        
        const connectcontract =async()=> {
			const ABI=[
						
				{
					"inputs": [
						{
							"internalType": "string",
							"name": "_name",
							"type": "string"
						},
						{
							"internalType": "string",
							"name": "patientName",
							"type": "string"
						},
						{
							"internalType": "uint256",
							"name": "patientAge",
							"type": "uint256"
						},
						{
							"internalType": "uint256",
							"name": "patientId",
							"type": "uint256"
						},
						{
							"internalType": "uint256",
							"name": "patientHeight",
							"type": "uint256"
						}
					],
					"stateMutability": "nonpayable",
					"type": "constructor"
				},
				{
					"inputs": [],
					"name": "balanceeth",
					"outputs": [
						{
							"internalType": "uint256",
							"name": "",
							"type": "uint256"
						}
					],
					"stateMutability": "view",
					"type": "function"
				},
				{
					"inputs": [],
					"name": "balanceusd",
					"outputs": [
						{
							"internalType": "uint256",
							"name": "",
							"type": "uint256"
						}
					],
					"stateMutability": "view",
					"type": "function"
				},
				{
					"inputs": [],
					"name": "deadline",
					"outputs": [
						{
							"internalType": "uint256",
							"name": "",
							"type": "uint256"
						}
					],
					"stateMutability": "view",
					"type": "function"
				},
				{
					"inputs": [],
					"name": "donlefteth",
					"outputs": [
						{
							"internalType": "uint256",
							"name": "",
							"type": "uint256"
						}
					],
					"stateMutability": "view",
					"type": "function"
				},
				{
					"inputs": [],
					"name": "donleftusd",
					"outputs": [
						{
							"internalType": "uint256",
							"name": "",
							"type": "uint256"
						}
					],
					"stateMutability": "view",
					"type": "function"
				},
				{
					"inputs": [
						{
							"internalType": "address",
							"name": "",
							"type": "address"
						}
					],
					"name": "funders",
					"outputs": [
						{
							"internalType": "uint256",
							"name": "",
							"type": "uint256"
						}
					],
					"stateMutability": "view",
					"type": "function"
				},
				{
					"inputs": [],
					"name": "getLatestPrice",
					"outputs": [
						{
							"internalType": "int256",
							"name": "",
							"type": "int256"
						}
					],
					"stateMutability": "view",
					"type": "function"
				},
				{
					"inputs": [
						{
							"internalType": "uint256",
							"name": "patientId",
							"type": "uint256"
						}
					],
					"name": "getPatientAge",
					"outputs": [
						{
							"internalType": "uint256",
							"name": "",
							"type": "uint256"
						}
					],
					"stateMutability": "view",
					"type": "function"
				},
				{
					"inputs": [
						{
							"internalType": "uint256",
							"name": "patientId",
							"type": "uint256"
						}
					],
					"name": "getPatientHeight",
					"outputs": [
						{
							"internalType": "uint256",
							"name": "",
							"type": "uint256"
						}
					],
					"stateMutability": "view",
					"type": "function"
				},
				{
					"inputs": [
						{
							"internalType": "uint256",
							"name": "patientId",
							"type": "uint256"
						}
					],
					"name": "getPatientName",
					"outputs": [
						{
							"internalType": "string",
							"name": "",
							"type": "string"
						}
					],
					"stateMutability": "view",
					"type": "function"
				},
				{
					"inputs": [],
					"name": "goaleth",
					"outputs": [
						{
							"internalType": "uint256",
							"name": "",
							"type": "uint256"
						}
					],
					"stateMutability": "view",
					"type": "function"
				},
				{
					"inputs": [],
					"name": "goalusd",
					"outputs": [
						{
							"internalType": "uint256",
							"name": "",
							"type": "uint256"
						}
					],
					"stateMutability": "view",
					"type": "function"
				},
				{
					"inputs": [],
					"name": "owner",
					"outputs": [
						{
							"internalType": "address",
							"name": "",
							"type": "address"
						}
					],
					"stateMutability": "view",
					"type": "function"
				},
				{
					"inputs": [
						{
							"internalType": "uint256",
							"name": "",
							"type": "uint256"
						}
					],
					"name": "patients",
					"outputs": [
						{
							"internalType": "string",
							"name": "name",
							"type": "string"
						},
						{
							"internalType": "uint256",
							"name": "age",
							"type": "uint256"
						},
						{
							"internalType": "uint256",
							"name": "id",
							"type": "uint256"
						},
						{
							"internalType": "uint256",
							"name": "height",
							"type": "uint256"
						}
					],
					"stateMutability": "view",
					"type": "function"
				},
				{
					"inputs": [],
					"name": "sendername",
					"outputs": [
						{
							"internalType": "string",
							"name": "",
							"type": "string"
						}
					],
					"stateMutability": "view",
					"type": "function"
				},
				{
					"inputs": [],
					"name": "transactionid",
					"outputs": [
						{
							"internalType": "uint256",
							"name": "",
							"type": "uint256"
						}
					],
					"stateMutability": "view",
					"type": "function"
				}
			];
			window.web3 = await new Web3(window.ethereum);
            window.contract = await new window.web3.eth.Contract(ABI, address);    //NOW THAT WE HAVE THE ADDRESS AND ABI, WE CREATE AN INSTANCE OF THE CONTRACT IN JAVASCRIPT
        }
    
            async function sendDataToContract(name, age, height) {
            // Request account access if needed
            await ethereum.request({ method: 'eth_requestAccounts' });

            // Use the first account
            const [account] = await web3.eth.getAccounts();
            contract.methods.yourContractMethod(name, age, height).send({ from: account })
                .then(function(result) {
                    console.log(result);
                })
                .catch(function(error) {
                    console.error(error);
                });
        }
                // Function to retrieve and display patient data
                async function displayPatientData(patientId) {
            try {
                const patientName = await contract.methods.getPatientName(patientId).call();
                const patientAge = await contract.methods.getPatientAge(patientId).call();
                const patientHeight = await contract.methods.getPatientHeight(patientId).call();

                addPatientToTable(patientName, patientAge, patientHeight);
            } catch (error) {
                console.error("Error retrieving patient data:", error);
            }
        }
        function addPatientToTable(name, age, height) {
            var table = document.querySelector('.patient-records-table tbody');
            var newRow = table.insertRow();

            var cell1 = newRow.insertCell(0);
            var cell2 = newRow.insertCell(1);
            var cell3 = newRow.insertCell(2);

            cell1.textContent = name;
            cell2.textContent = age;
            cell3.textContent = height;
        }
</script>
</body>
</html>